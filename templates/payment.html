<!-- <form id="im-pay-form" action="{$form_url}" method="POST">
{foreach $hidden_fields as $name => $value}
    <input type="hidden" name="{$name}" value="{$value|escape}">
{/foreach}
    {if $auto_submit}
        <script type="text/javascript">
            document.getElementById('im-pay-form').submit();
        </script>
    {else}
        <input type="submit" value="Оплатить заказ на сайте «IntellectMoney»">
    {/if}
</form>-->
<script src="https://widget.cloudpayments.ru/bundles/cloudpayments"></script>
<script type="text/javascript">
    $(function () {
        // Register payment function
        var pay = function () {

            var description = 'Product full of wonders';
            var amount = 1238;
            var email = $('#field_email').val();
            var name = $('#field_name').val();
            var phone = $('#field_phone').val();

            var account_id = 'qweqwe';
            if (!account_id.trim()) {
                account_id = email;
            }

            // 'data' parameter of the CloudPayments request
            var data = {
                name: name,
                phone: phone,
                cloudPayments: {
                    customerReceipt: {
                        Items: [
                            {
                                label: description,
                                price: amount,
                                quantity: 1.00,
                                amount: amount,
                                vat: null,
                                ean13: null
                            }
                        ],
                        taxationSystem: 2,
                        email: email,
                        phone: phone
                    }
                }
            };

            // 'charge' parameter of the CloudPayments .charge() request
            var charge = {
                publicId: '<?php echo $public_id; ?>',
                description: description,
                amount: amount,
                currency: '<?php echo $currency; ?>',
                invoiceId: '<?php echo $invoice_id; ?>',
                accountId: account_id,
                email: email,
                requireEmail: true,
                data: data
            };

            // Debug to the console
            console.log(charge);

            var widget = new cp.CloudPayments();
            widget.charge(charge,
                '/success.php',
                '/failure.php'
            );
        };

        // Assign handler
        $('#checkout').click(pay);
    });
</script>
<form id="cp-pay-form" action="#" method="get">
    {foreach $hidden_fields as $name => $value}
    <div><span>name="{$name}"</span>&nbsp;<span>value="{$value|escape}"</span>
        {/foreach}
        <div class="wrapper_submit">
            <input type="button" id="checkout"
                   value="Открыть окно оплаты1"
                   class="btn">
        </div>
</form>